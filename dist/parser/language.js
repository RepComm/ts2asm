/**Defines a requirement for a statement definition to be satisfied
 * Requirements can be specific tokens or statements
 * 
 * ```typescript
 * //Example
 * let req: RequirementDefinition = {
 *     type: "token",
 *     tokenType: "bracket",
 *     tokenData: "{" //optional, specifies token must match exactly
 * }
 * ```
 */

/**Defines a statement
 * 
 * A statement is any piece of code that is distinct from another
 * 
 * Examples:
 * 
 * ```javascript
 * //single
 * let i=0;
 * 
 * //compound
 * for (let i=0; i<10; i++) {}
 * ```
 */

/**Defines a language
 * 
 * Can be stringified to JSON
 * 
 */
export class Language {
  constructor(name) {
    this.name = name;
    this.statmentTemplates = new Set();
  }

  getName() {
    return this.name;
  }

  hasStatementTemplate(template) {
    return this.statmentTemplates.has(template);
  }

  addStatementTemplate(template) {
    if (this.hasStatementTemplate(template)) throw `Cannot add statement template more than once ${template}`;
    this.statmentTemplates.add(template);
    return this;
  }

  createStatementTemplate(id) {
    let result = new StatementTemplate(id);
    this.addStatementTemplate(result);
    return result;
  }

  getStatementTemplates() {
    return this.statmentTemplates;
  }

  static fromJSON(langDef) {
    let result = new Language(langDef.name); //loop through and add statements

    for (let statmentDef of langDef.statmentTemplates) {
      let statement = StatementTemplate.fromJSON(statmentDef);
      result.addStatementTemplate(statement);
    }

    return result;
  }

  toJSON() {
    let templateCount = this.statmentTemplates.size;
    let templateDefs = new Array(templateCount);
    let i = 0;

    for (let template of this.statmentTemplates) {
      templateDefs[i] = template.toJSON();
      i++;
    }

    let result = {
      name: this.getName(),
      statmentTemplates: templateDefs
    };
    return result;
  }

}
/**Parsers use templates to match tokens to language structures
 * such as blocks, declarations, assignments, loops, function bodies, etc
 * 
 * Statements are made up (ultimately) of tokens,
 * but this implementation of Statement may be made up of other statements and tokens
 * 
 * This allows extensibility of statements, and renders "expressions" obsolete
 */

export class StatementTemplate {
  constructor(id) {
    this.id = id;
    this.requirements = new Array();
  }

  getId() {
    return this.id;
  }

  setAbstract(abs) {
    this.abstract = abs;
    return this;
  }

  isAbstract() {
    return this.abstract;
  }

  hasRequirement(req) {
    return this.requirements.includes(req);
  }

  addRequirement(req) {
    if (this.hasRequirement(req)) throw `Cannot add requirement more than once, you can set <requirement>.repeat = <number> for this functionality`;
    this.requirements.push(req);
    return this;
  }

  getRequirements() {
    return this.requirements;
  }

  static fromJSON(statDef) {
    let result = new StatementTemplate(statDef.id);
    result.setAbstract(statDef.abstract);

    for (let reqDef of statDef.requirements) {
      let req = Requirement.fromJSON(reqDef);
      result.addRequirement(req);
    }

    return result;
  }

  toJSON() {
    let requirementCount = this.requirements.length;
    let requirementDefs = new Array(requirementCount);
    let i = 0;

    for (let requirement of this.requirements) {
      requirementDefs[i] = requirement.toJSON();
      i++;
    }

    let result = {
      id: this.getId(),
      requirements: requirementDefs
    };
    return result;
  }

}
export class Requirement {
  constructor() {
    this.repeat = 0;
  }

  getType() {
    return this.type;
  }

  setType(type) {
    this.type = type;
    return this;
  }

  getTokenType() {
    return this.tokenType;
  }

  setTokenType(type) {
    this.tokenType = type;
    return this;
  }

  hasTokenType() {
    return this.tokenType != null && this.tokenType != undefined;
  }

  getTokenData() {
    return this.tokenData;
  }

  setTokenData(data) {
    this.tokenData = data;
    return this;
  }

  hasTokenData() {
    return this.tokenData != null && this.tokenData != undefined;
  }

  getStatementId() {
    return this.statementId;
  }

  setStatementId(id) {
    this.statementId = id;
    return this;
  }

  hasStatementId() {
    return this.statementId != null && this.statementId != null;
  }

  getRepeats() {
    return this.repeat;
  }
  /**Set how many times to repeat this requirement to satisfy a statement using it
   * 
   * `-1` = unlimited (until next requirement is satisfied)
   * 
   * `0` = no *additional* repeats
   * 
   * `1` = requires 2 of same requirement in a row
   * 
   * @param times 
   */


  setRepeats(times) {
    this.repeat = times;
    return this;
  }

  static fromJSON(def) {
    let result = new Requirement();
    result.setType(def.type);
    result.setStatementId(def.statementId);
    result.setTokenType(def.tokenType);
    result.setTokenData(def.tokenData);
    result.setRepeats(def.repeat);
    return result;
  }

  toJSON() {
    //TODO - error check here
    return {
      type: this.getType(),
      repeat: this.getRepeats(),
      tokenData: this.getTokenData(),
      tokenType: this.getTokenType(),
      statementId: this.getStatementId()
    };
  }

}

/**A valid instance of a statement template
 * 
 * Will never be instantiated unless the template it was created from was
 * completely satisfied
 */
export class Statement {
  constructor() {
    this.items = new Array();
  }

  addItem(item) {
    this.items.push(item);
    return this;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYXJzZXIvbGFuZ3VhZ2UudHMiXSwibmFtZXMiOlsiTGFuZ3VhZ2UiLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJzdGF0bWVudFRlbXBsYXRlcyIsIlNldCIsImdldE5hbWUiLCJoYXNTdGF0ZW1lbnRUZW1wbGF0ZSIsInRlbXBsYXRlIiwiaGFzIiwiYWRkU3RhdGVtZW50VGVtcGxhdGUiLCJhZGQiLCJjcmVhdGVTdGF0ZW1lbnRUZW1wbGF0ZSIsImlkIiwicmVzdWx0IiwiU3RhdGVtZW50VGVtcGxhdGUiLCJnZXRTdGF0ZW1lbnRUZW1wbGF0ZXMiLCJmcm9tSlNPTiIsImxhbmdEZWYiLCJzdGF0bWVudERlZiIsInN0YXRlbWVudCIsInRvSlNPTiIsInRlbXBsYXRlQ291bnQiLCJzaXplIiwidGVtcGxhdGVEZWZzIiwiQXJyYXkiLCJpIiwicmVxdWlyZW1lbnRzIiwiZ2V0SWQiLCJzZXRBYnN0cmFjdCIsImFicyIsImFic3RyYWN0IiwiaXNBYnN0cmFjdCIsImhhc1JlcXVpcmVtZW50IiwicmVxIiwiaW5jbHVkZXMiLCJhZGRSZXF1aXJlbWVudCIsInB1c2giLCJnZXRSZXF1aXJlbWVudHMiLCJzdGF0RGVmIiwicmVxRGVmIiwiUmVxdWlyZW1lbnQiLCJyZXF1aXJlbWVudENvdW50IiwibGVuZ3RoIiwicmVxdWlyZW1lbnREZWZzIiwicmVxdWlyZW1lbnQiLCJyZXBlYXQiLCJnZXRUeXBlIiwidHlwZSIsInNldFR5cGUiLCJnZXRUb2tlblR5cGUiLCJ0b2tlblR5cGUiLCJzZXRUb2tlblR5cGUiLCJoYXNUb2tlblR5cGUiLCJ1bmRlZmluZWQiLCJnZXRUb2tlbkRhdGEiLCJ0b2tlbkRhdGEiLCJzZXRUb2tlbkRhdGEiLCJkYXRhIiwiaGFzVG9rZW5EYXRhIiwiZ2V0U3RhdGVtZW50SWQiLCJzdGF0ZW1lbnRJZCIsInNldFN0YXRlbWVudElkIiwiaGFzU3RhdGVtZW50SWQiLCJnZXRSZXBlYXRzIiwic2V0UmVwZWF0cyIsInRpbWVzIiwiZGVm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TUFBQUEsSUFBSSxFQUFFLEtBQUtELE9BQUwsRUFERDtBQUVMRCxNQUFBQSxNQUFNLEVBQUUsS0FBS2tCLFVBQUwsRUFGSDtBQUdMUixNQUFBQSxTQUFTLEVBQUUsS0FBS0QsWUFBTCxFQUhOO0FBSUxKLE1BQUFBLFNBQVMsRUFBRSxLQUFLRCxZQUFMLEVBSk47QUFLTFcsTUFBQUEsV0FBVyxFQUFFLEtBQUtELGNBQUw7QUFMUixLQUFQO0FBT0Q7O0FBcEZzQjs7QUF5RnpCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLE1BQU1RLFNBQU4sQ0FBZ0I7QUFFckJsRSxFQUFBQSxXQUFXLEdBQUc7QUFDWixTQUFLbUUsS0FBTCxHQUFhLElBQUk1QyxLQUFKLEVBQWI7QUFDRDs7QUFDRDZDLEVBQUFBLE9BQU8sQ0FBQ0MsSUFBRCxFQUE0QjtBQUNqQyxTQUFLRixLQUFMLENBQVdoQyxJQUFYLENBQWdCa0MsSUFBaEI7QUFDQSxXQUFPLElBQVA7QUFDRDs7QUFSb0IiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IFRva2VuIH0gZnJvbSBcIi4uL3Rva2VuaXplci90b2tlbi5qc1wiO1xuXG5leHBvcnQgdHlwZSBSZXF1aXJlbWVudFR5cGUgPSBcInRva2VuXCIgfCBcInN0YXRlbWVudFwiO1xuXG4vKipEZWZpbmVzIGEgcmVxdWlyZW1lbnQgZm9yIGEgc3RhdGVtZW50IGRlZmluaXRpb24gdG8gYmUgc2F0aXNmaWVkXG4gKiBSZXF1aXJlbWVudHMgY2FuIGJlIHNwZWNpZmljIHRva2VucyBvciBzdGF0ZW1lbnRzXG4gKiBcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIC8vRXhhbXBsZVxuICogbGV0IHJlcTogUmVxdWlyZW1lbnREZWZpbml0aW9uID0ge1xuICogICAgIHR5cGU6IFwidG9rZW5cIixcbiAqICAgICB0b2tlblR5cGU6IFwiYnJhY2tldFwiLFxuICogICAgIHRva2VuRGF0YTogXCJ7XCIgLy9vcHRpb25hbCwgc3BlY2lmaWVzIHRva2VuIG11c3QgbWF0Y2ggZXhhY3RseVxuICogfVxuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVxdWlyZW1lbnREZWZpbml0aW9uIHtcbiAgdHlwZTogUmVxdWlyZW1lbnRUeXBlO1xuICAvKipNdXN0IGJlIHByZXNlbnQgd2hlbiB0eXBlID09IFwidG9rZW5cIiovXG4gIHRva2VuVHlwZT86IHN0cmluZztcbiAgLyoqT3B0aW9uYWwsIHVzZWQgd2hlbiB0eXBlID09IFwidG9rZW5cIlxuICAgKiBcbiAgICogSWYgdHJ1dGgteSwgdGhlIHJlYWQgdG9rZW4gbXVzdCBoYXZlIGFuIGV4YWN0IG1hdGNoLCBvciB0aGUgcGFyc2VyIHdpbGwgdHJlYXQgdGhlXG4gICAqIHN0YXRlbWVudCBwYXNzIGFzIGFuIGVycm9yIGFuZCB0cnkgYSBkaWZmZXJlbnQgc3RhdGVtZW50IHBhc3NcbiAgICogXG4gICAqIChhbmQgdWx0aW1hdGVseSBlcnJvciByZXBvcnQgaWYgbm8gbWF0Y2ggZm91bmQpXG4gICAqL1xuICB0b2tlbkRhdGE/OiBzdHJpbmc7XG4gIC8qKk9wdGlvbmFsLCB1c2VkIHdoZW4gdHlwZSA9PSBcInN0YXRlbWVudFwiXG4gICAqIFxuICAgKiBUaGUgc3RhdGVtZW50IHRlbXBsYXRlIGlkIHRoYXQgd2lsbCBiZSB1c2VkXG4gICAqIFxuICAgKiBJZiBmYWxzZS15LCB0aGUgcGFyc2VyIGlzIGZyZWUgdG8gcmVhZCB3aGF0ZXZlciBzdGF0ZW1lbnQgdHlwZSBpdCBjYW5cbiAgICovXG4gIHN0YXRlbWVudElkPzogc3RyaW5nO1xuICAvKipPcHRpb25hbCwgc2V0IHdoZW4geW91IHdhbnQgdGhlIHJlcXVpcmVtZW50IHRvIGJlIHJlcGVhdGVkIGEgbnVtYmVyIG9mIHRpbWVzXG4gICAqIFxuICAgKiBEZWZhdWx0IGlzIDFcbiAgICogXG4gICAqIFNldCB0byAtMSBmb3IgdW5saW1pdGVkIChwbGVhc2Uga25vdyB3aGF0IHlvdSdyZSBkb2luZywgb3IgdGhpcyB3aWxsIGxvb3AgZm9yZXZlcilcbiAgICovXG4gIHJlcGVhdD86IG51bWJlcjtcbn1cblxuLyoqRGVmaW5lcyBhIHN0YXRlbWVudFxuICogXG4gKiBBIHN0YXRlbWVudCBpcyBhbnkgcGllY2Ugb2YgY29kZSB0aGF0IGlzIGRpc3RpbmN0IGZyb20gYW5vdGhlclxuICogXG4gKiBFeGFtcGxlczpcbiAqIFxuICogYGBgamF2YXNjcmlwdFxuICogLy9zaW5nbGVcbiAqIGxldCBpPTA7XG4gKiBcbiAqIC8vY29tcG91bmRcbiAqIGZvciAobGV0IGk9MDsgaTwxMDsgaSsrKSB7fVxuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGVtZW50RGVmaW5pdGlvbiB7XG4gIC8qKlRoZSB1bmlxdWUgaWQgb2YgdGhlIHN0YXRlbWVudFxuICAgKiBVc2VkIGJ5IGNvbXBvdW5kIHN0YXRlbWVudHMgKHN0YXRlbWVudHMgdGhhdCByZXF1aXJlIG90aGVyIHN0YXRlbWVudHMpXG4gICAqL1xuICBpZDogc3RyaW5nO1xuICAvKipUcnVlIHdoZW4gdGhlIHN0YXRlbWVudCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIGJ5IGl0c2VsZiwgcmF0aGVyLCByZXF1aXJlZCBieSBhbm90aGVyIHN0YXRlbWVudCovXG4gIGFic3RyYWN0PzogYm9vbGVhbjtcbiAgLyoqQW4gb3JkZXJlZCBsaXN0IG9mIHJlcXVpcmVtZW50cyB0aGF0IG1ha2UgdXAgdGhlIHN0YXRlbWVudCdzIGNvbnRlbnQqL1xuICByZXF1aXJlbWVudHM6IEFycmF5PFJlcXVpcmVtZW50RGVmaW5pdGlvbj47XG59XG5cbi8qKkRlZmluZXMgYSBsYW5ndWFnZVxuICogXG4gKiBDYW4gYmUgc3RyaW5naWZpZWQgdG8gSlNPTlxuICogXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTGFuZ3VhZ2VEZWZpbml0aW9uIHtcbiAgLyoqVGhlIG5hbWUgb2YgdGhlIGxhbmd1YWdlIHN5bnRheCovXG4gIG5hbWU6IHN0cmluZztcbiAgLyoqRGVmaW5pdGlvbnMgZm9yIHN0YXRlbWVudHMgdGhhdCB0b2tlbnMgY2FuIGJlIHBhcnNlZCBpbnRvKi9cbiAgc3RhdG1lbnRUZW1wbGF0ZXM6IEFycmF5PFN0YXRlbWVudERlZmluaXRpb24+O1xufVxuXG5leHBvcnQgY2xhc3MgTGFuZ3VhZ2Uge1xuICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBzdGF0bWVudFRlbXBsYXRlczogU2V0PFN0YXRlbWVudFRlbXBsYXRlPjtcblxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuc3RhdG1lbnRUZW1wbGF0ZXMgPSBuZXcgU2V0KCk7XG4gIH1cbiAgZ2V0TmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm5hbWU7XG4gIH1cbiAgaGFzU3RhdGVtZW50VGVtcGxhdGUodGVtcGxhdGU6IFN0YXRlbWVudFRlbXBsYXRlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdG1lbnRUZW1wbGF0ZXMuaGFzKHRlbXBsYXRlKTtcbiAgfVxuICBhZGRTdGF0ZW1lbnRUZW1wbGF0ZSh0ZW1wbGF0ZTogU3RhdGVtZW50VGVtcGxhdGUpOiB0aGlzIHtcbiAgICBpZiAodGhpcy5oYXNTdGF0ZW1lbnRUZW1wbGF0ZSh0ZW1wbGF0ZSkpIHRocm93IGBDYW5ub3QgYWRkIHN0YXRlbWVudCB0ZW1wbGF0ZSBtb3JlIHRoYW4gb25jZSAke3RlbXBsYXRlfWA7XG4gICAgdGhpcy5zdGF0bWVudFRlbXBsYXRlcy5hZGQodGVtcGxhdGUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGNyZWF0ZVN0YXRlbWVudFRlbXBsYXRlKGlkOiBzdHJpbmcpOiBTdGF0ZW1lbnRUZW1wbGF0ZSB7XG4gICAgbGV0IHJlc3VsdCA9IG5ldyBTdGF0ZW1lbnRUZW1wbGF0ZShpZCk7XG4gICAgdGhpcy5hZGRTdGF0ZW1lbnRUZW1wbGF0ZShyZXN1bHQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgZ2V0U3RhdGVtZW50VGVtcGxhdGVzKCk6IFNldDxTdGF0ZW1lbnRUZW1wbGF0ZT4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRtZW50VGVtcGxhdGVzO1xuICB9XG4gIHN0YXRpYyBmcm9tSlNPTihsYW5nRGVmOiBMYW5ndWFnZURlZmluaXRpb24pOiBMYW5ndWFnZSB7XG4gICAgbGV0IHJlc3VsdCA9IG5ldyBMYW5ndWFnZShsYW5nRGVmLm5hbWUpO1xuXG4gICAgLy9sb29wIHRocm91Z2ggYW5kIGFkZCBzdGF0ZW1lbnRzXG4gICAgZm9yIChsZXQgc3RhdG1lbnREZWYgb2YgbGFuZ0RlZi5zdGF0bWVudFRlbXBsYXRlcykge1xuICAgICAgbGV0IHN0YXRlbWVudCA9IFN0YXRlbWVudFRlbXBsYXRlLmZyb21KU09OKHN0YXRtZW50RGVmKTtcbiAgICAgIHJlc3VsdC5hZGRTdGF0ZW1lbnRUZW1wbGF0ZShzdGF0ZW1lbnQpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgdG9KU09OKCk6IExhbmd1YWdlRGVmaW5pdGlvbiB7XG4gICAgbGV0IHRlbXBsYXRlQ291bnQgPSB0aGlzLnN0YXRtZW50VGVtcGxhdGVzLnNpemU7XG4gICAgbGV0IHRlbXBsYXRlRGVmcyA9IG5ldyBBcnJheTxTdGF0ZW1lbnREZWZpbml0aW9uPih0ZW1wbGF0ZUNvdW50KTtcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChsZXQgdGVtcGxhdGUgb2YgdGhpcy5zdGF0bWVudFRlbXBsYXRlcykge1xuICAgICAgdGVtcGxhdGVEZWZzW2ldID0gdGVtcGxhdGUudG9KU09OKCk7XG4gICAgICBpKys7XG4gICAgfVxuICAgIGxldCByZXN1bHQ6IExhbmd1YWdlRGVmaW5pdGlvbiA9IHtcbiAgICAgIG5hbWU6IHRoaXMuZ2V0TmFtZSgpLFxuICAgICAgc3RhdG1lbnRUZW1wbGF0ZXM6IHRlbXBsYXRlRGVmc1xuICAgIH07XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vKipQYXJzZXJzIHVzZSB0ZW1wbGF0ZXMgdG8gbWF0Y2ggdG9rZW5zIHRvIGxhbmd1YWdlIHN0cnVjdHVyZXNcbiAqIHN1Y2ggYXMgYmxvY2tzLCBkZWNsYXJhdGlvbnMsIGFzc2lnbm1lbnRzLCBsb29wcywgZnVuY3Rpb24gYm9kaWVzLCBldGNcbiAqIFxuICogU3RhdGVtZW50cyBhcmUgbWFkZSB1cCAodWx0aW1hdGVseSkgb2YgdG9rZW5zLFxuICogYnV0IHRoaXMgaW1wbGVtZW50YXRpb24gb2YgU3RhdGVtZW50IG1heSBiZSBtYWRlIHVwIG9mIG90aGVyIHN0YXRlbWVudHMgYW5kIHRva2Vuc1xuICogXG4gKiBUaGlzIGFsbG93cyBleHRlbnNpYmlsaXR5IG9mIHN0YXRlbWVudHMsIGFuZCByZW5kZXJzIFwiZXhwcmVzc2lvbnNcIiBvYnNvbGV0ZVxuICovXG5leHBvcnQgY2xhc3MgU3RhdGVtZW50VGVtcGxhdGUge1xuICBwcml2YXRlIGlkOiBzdHJpbmc7XG4gIHByaXZhdGUgYWJzdHJhY3Q6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVxdWlyZW1lbnRzOiBBcnJheTxSZXF1aXJlbWVudD47XG5cbiAgY29uc3RydWN0b3IoaWQ6IHN0cmluZykge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLnJlcXVpcmVtZW50cyA9IG5ldyBBcnJheSgpO1xuICB9XG4gIGdldElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaWQ7XG4gIH1cbiAgc2V0QWJzdHJhY3QoYWJzOiBib29sZWFuKTogdGhpcyB7XG4gICAgdGhpcy5hYnN0cmFjdCA9IGFicztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBpc0Fic3RyYWN0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmFic3RyYWN0O1xuICB9XG4gIGhhc1JlcXVpcmVtZW50KHJlcTogUmVxdWlyZW1lbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1aXJlbWVudHMuaW5jbHVkZXMocmVxKTtcbiAgfVxuICBhZGRSZXF1aXJlbWVudChyZXE6IFJlcXVpcmVtZW50KTogdGhpcyB7XG4gICAgaWYgKHRoaXMuaGFzUmVxdWlyZW1lbnQocmVxKSkgdGhyb3cgYENhbm5vdCBhZGQgcmVxdWlyZW1lbnQgbW9yZSB0aGFuIG9uY2UsIHlvdSBjYW4gc2V0IDxyZXF1aXJlbWVudD4ucmVwZWF0ID0gPG51bWJlcj4gZm9yIHRoaXMgZnVuY3Rpb25hbGl0eWA7XG4gICAgdGhpcy5yZXF1aXJlbWVudHMucHVzaChyZXEpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGdldFJlcXVpcmVtZW50cygpOiBBcnJheTxSZXF1aXJlbWVudD4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVpcmVtZW50cztcbiAgfVxuICBzdGF0aWMgZnJvbUpTT04oc3RhdERlZjogU3RhdGVtZW50RGVmaW5pdGlvbik6IFN0YXRlbWVudFRlbXBsYXRlIHtcbiAgICBsZXQgcmVzdWx0ID0gbmV3IFN0YXRlbWVudFRlbXBsYXRlKHN0YXREZWYuaWQpO1xuXG4gICAgcmVzdWx0LnNldEFic3RyYWN0KHN0YXREZWYuYWJzdHJhY3QpO1xuXG4gICAgZm9yIChsZXQgcmVxRGVmIG9mIHN0YXREZWYucmVxdWlyZW1lbnRzKSB7XG4gICAgICBsZXQgcmVxID0gUmVxdWlyZW1lbnQuZnJvbUpTT04ocmVxRGVmKTtcbiAgICAgIHJlc3VsdC5hZGRSZXF1aXJlbWVudChyZXEpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgdG9KU09OKCk6IFN0YXRlbWVudERlZmluaXRpb24ge1xuICAgIGxldCByZXF1aXJlbWVudENvdW50ID0gdGhpcy5yZXF1aXJlbWVudHMubGVuZ3RoO1xuICAgIGxldCByZXF1aXJlbWVudERlZnMgPSBuZXcgQXJyYXk8UmVxdWlyZW1lbnREZWZpbml0aW9uPihyZXF1aXJlbWVudENvdW50KTtcblxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGxldCByZXF1aXJlbWVudCBvZiB0aGlzLnJlcXVpcmVtZW50cykge1xuICAgICAgcmVxdWlyZW1lbnREZWZzW2ldID0gcmVxdWlyZW1lbnQudG9KU09OKCk7XG4gICAgICBpKys7XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdDogU3RhdGVtZW50RGVmaW5pdGlvbiA9IHtcbiAgICAgIGlkOiB0aGlzLmdldElkKCksXG4gICAgICByZXF1aXJlbWVudHM6IHJlcXVpcmVtZW50RGVmc1xuICAgIH07XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmVxdWlyZW1lbnQge1xuICBwcml2YXRlIHR5cGU6IFJlcXVpcmVtZW50VHlwZTtcbiAgcHJpdmF0ZSByZXBlYXQ6IG51bWJlcjtcbiAgcHJpdmF0ZSBzdGF0ZW1lbnRJZD86IHN0cmluZztcbiAgcHJpdmF0ZSB0b2tlblR5cGU/OiBzdHJpbmc7XG4gIHByaXZhdGUgdG9rZW5EYXRhPzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucmVwZWF0ID0gMDtcbiAgfVxuICBnZXRUeXBlKCk6IFJlcXVpcmVtZW50VHlwZSB7XG4gICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgfVxuICBzZXRUeXBlKHR5cGU6IFJlcXVpcmVtZW50VHlwZSk6IHRoaXMge1xuICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZ2V0VG9rZW5UeXBlKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMudG9rZW5UeXBlO1xuICB9XG4gIHNldFRva2VuVHlwZSh0eXBlOiBzdHJpbmcpOiB0aGlzIHtcbiAgICB0aGlzLnRva2VuVHlwZSA9IHR5cGU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgaGFzVG9rZW5UeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRva2VuVHlwZSAhPSBudWxsICYmIHRoaXMudG9rZW5UeXBlICE9IHVuZGVmaW5lZDtcbiAgfVxuICBnZXRUb2tlbkRhdGEoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy50b2tlbkRhdGE7XG4gIH1cbiAgc2V0VG9rZW5EYXRhKGRhdGE6IHN0cmluZyk6IHRoaXMge1xuICAgIHRoaXMudG9rZW5EYXRhID0gZGF0YTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBoYXNUb2tlbkRhdGEoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudG9rZW5EYXRhICE9IG51bGwgJiYgdGhpcy50b2tlbkRhdGEgIT0gdW5kZWZpbmVkO1xuICB9XG4gIGdldFN0YXRlbWVudElkKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGVtZW50SWQ7XG4gIH1cbiAgc2V0U3RhdGVtZW50SWQoaWQ6IHN0cmluZyk6IHRoaXMge1xuICAgIHRoaXMuc3RhdGVtZW50SWQgPSBpZDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBoYXNTdGF0ZW1lbnRJZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZW1lbnRJZCAhPSBudWxsICYmIHRoaXMuc3RhdGVtZW50SWQgIT0gbnVsbDtcbiAgfVxuICBnZXRSZXBlYXRzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucmVwZWF0O1xuICB9XG4gIC8qKlNldCBob3cgbWFueSB0aW1lcyB0byByZXBlYXQgdGhpcyByZXF1aXJlbWVudCB0byBzYXRpc2Z5IGEgc3RhdGVtZW50IHVzaW5nIGl0XG4gICAqIFxuICAgKiBgLTFgID0gdW5saW1pdGVkICh1bnRpbCBuZXh0IHJlcXVpcmVtZW50IGlzIHNhdGlzZmllZClcbiAgICogXG4gICAqIGAwYCA9IG5vICphZGRpdGlvbmFsKiByZXBlYXRzXG4gICAqIFxuICAgKiBgMWAgPSByZXF1aXJlcyAyIG9mIHNhbWUgcmVxdWlyZW1lbnQgaW4gYSByb3dcbiAgICogXG4gICAqIEBwYXJhbSB0aW1lcyBcbiAgICovXG4gIHNldFJlcGVhdHModGltZXM6IG51bWJlcik6IHRoaXMge1xuICAgIHRoaXMucmVwZWF0ID0gdGltZXM7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgc3RhdGljIGZyb21KU09OKGRlZjogUmVxdWlyZW1lbnREZWZpbml0aW9uKTogUmVxdWlyZW1lbnQge1xuICAgIGxldCByZXN1bHQgPSBuZXcgUmVxdWlyZW1lbnQoKTtcbiAgICByZXN1bHQuc2V0VHlwZShkZWYudHlwZSk7XG5cbiAgICByZXN1bHQuc2V0U3RhdGVtZW50SWQoZGVmLnN0YXRlbWVudElkKTtcbiAgICByZXN1bHQuc2V0VG9rZW5UeXBlKGRlZi50b2tlblR5cGUpO1xuICAgIHJlc3VsdC5zZXRUb2tlbkRhdGEoZGVmLnRva2VuRGF0YSk7XG5cbiAgICByZXN1bHQuc2V0UmVwZWF0cyhkZWYucmVwZWF0KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIHRvSlNPTigpOiBSZXF1aXJlbWVudERlZmluaXRpb24ge1xuICAgIC8vVE9ETyAtIGVycm9yIGNoZWNrIGhlcmVcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogdGhpcy5nZXRUeXBlKCksXG4gICAgICByZXBlYXQ6IHRoaXMuZ2V0UmVwZWF0cygpLFxuICAgICAgdG9rZW5EYXRhOiB0aGlzLmdldFRva2VuRGF0YSgpLFxuICAgICAgdG9rZW5UeXBlOiB0aGlzLmdldFRva2VuVHlwZSgpLFxuICAgICAgc3RhdGVtZW50SWQ6IHRoaXMuZ2V0U3RhdGVtZW50SWQoKVxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgU3RhdGVtZW50SXRlbSA9IFRva2VuIHwgU3RhdGVtZW50O1xuXG4vKipBIHZhbGlkIGluc3RhbmNlIG9mIGEgc3RhdGVtZW50IHRlbXBsYXRlXG4gKiBcbiAqIFdpbGwgbmV2ZXIgYmUgaW5zdGFudGlhdGVkIHVubGVzcyB0aGUgdGVtcGxhdGUgaXQgd2FzIGNyZWF0ZWQgZnJvbSB3YXNcbiAqIGNvbXBsZXRlbHkgc2F0aXNmaWVkXG4gKi9cbmV4cG9ydCBjbGFzcyBTdGF0ZW1lbnQge1xuICBpdGVtczogQXJyYXk8U3RhdGVtZW50SXRlbT47XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXRlbXMgPSBuZXcgQXJyYXkoKTtcbiAgfVxuICBhZGRJdGVtKGl0ZW06IFN0YXRlbWVudEl0ZW0pOiB0aGlzIHtcbiAgICB0aGlzLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cbiJdfQ==