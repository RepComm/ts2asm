import { Token } from "./token.js";
/**Data returned by a scanner pass
 */

export class Scanner {
  constructor() {
    this.passes = new Map();
    this.offset = 0;
    this.readLines = 0;
    this.readLineChars = 0;
  }
  /**Adds a scan pass
   * Will throw an error if pass with same name already added
   * You can reuse pass callbacks just fine, but you'll need to use a different name
   * @param name
   * @param pass
   */


  addPass(name, pass) {
    if (this.hasPass(name)) throw `Already added pass, did you mean to override "${name}" using setPass instead?`;
    this.setPass(name, pass);
    return this;
  }
  /**Same as addPass, but won't bark at you for overwriting
   * @param name
   * @param pass 
   */


  setPass(name, pass) {
    this.passes.set(name, pass);
    return this;
  }
  /**Checks if a pass by a name exists
   * This is used internally for addPass and removePass
   * @param name
   */


  hasPass(name) {
    return this.passes.has(name);
  }

  removePass(name) {
    if (!this.hasPass(name)) throw `Cannot remove pass "${name}" as it isn't added currently`;
    this.passes.delete(name);
    return this;
  }

  setData(data) {
    this.data = data;
    return this;
  }

  hasData() {
    return this.data != null && this.data != undefined;
  }

  available() {
    return this.data.length - this.offset;
  }
  /**Will return the next token unless there is an error, in which case null is returned
   * 
   */


  next() {
    let result = null;
    let passData;
    if (this.offset == undefined) this.offset = 0;
    if (!this.hasData()) throw `No data assigned, cannot get next token`;

    if (this.offset > this.data.length - 1) {
      result = new Token();
      result.type = Token.TYPE_EOF;
    }

    let breakPassLoop = false;
    this.passes.forEach((pass, name) => {
      if (breakPassLoop) return;
      passData = pass(this.data, this.offset);

      if (passData.success) {
        result = new Token();
        result.type = name;
        result.data = this.data.substring(this.offset, this.offset + passData.readChars);
        this.offset += passData.readChars;
        this.readLines += passData.readLines;
        result.line = this.readLines;
        breakPassLoop = true;
      }
    });

    if (!breakPassLoop) {
      result = new Token();
      result.type = "error";
      result.data = `"${this.data.substring(this.offset, this.offset + 6)}..." at line ${this.readLines} char ${this.readLineChars} could not be parsed`;
    }

    return result;
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b2tlbml6ZXIvc2Nhbm5lci50cyJdLCJuYW1lcyI6WyJUb2tlbiIsIlNjYW5uZXIiLCJjb25zdHJ1Y3RvciIsInBhc3NlcyIsIk1hcCIsIm9mZnNldCIsInJlYWRMaW5lcyIsInJlYWRMaW5lQ2hhcnMiLCJhZGRQYXNzIiwibmFtZSIsInBhc3MiLCJoYXNQYXNzIiwic2V0UGFzcyIsInNldCIsImhhcyIsInJlbW92ZVBhc3MiLCJkZWxldGUiLCJzZXREYXRhIiwiZGF0YSIsImhhc0RhdGEiLCJ1bmRlZmluZWQiLCJhdmFpbGFibGUiLCJsZW5ndGgiLCJuZXh0IiwicmVzdWx0IiwicGFzc0RhdGEiLCJ0eXBlIiwiVFlQRV9FT0YiLCJicmVha1Bhc3NMb29wIiwiZm9yRWFjaCIsInN1Y2Nlc3MiLCJzdWJzdHJpbmciLCJyZWFkQ2hhcnMiLCJsaW5lIl0sIm1hcHBpbmdzIjoiQUFDQSxTQUFTQSxLQUFULFFBQXNCLFlBQXRCO0FBRUE7QUFDQTs7QUFvQkEsT0FBTyxNQUFNQyxPQUFOLENBQWM7QUFPbkJDLEVBQUFBLFdBQVcsR0FBRztBQUNaLFNBQUtDLE1BQUwsR0FBYyxJQUFJQyxHQUFKLEVBQWQ7QUFDQSxTQUFLQyxNQUFMLEdBQWMsQ0FBZDtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsQ0FBakI7QUFDQSxTQUFLQyxhQUFMLEdBQXFCLENBQXJCO0FBQ0Q7QUFDRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNFQyxFQUFBQSxPQUFPLENBQUNDLElBQUQsRUFBZUMsSUFBZixFQUF3QztBQUM3QyxRQUFJLEtBQUtDLE9BQUwsQ0FBYUYsSUFBYixDQUFKLEVBQXdCLE1BQU8saURBQWdEQSxJQUFLLDBCQUE1RDtBQUN4QixTQUFLRyxPQUFMLENBQWFILElBQWIsRUFBbUJDLElBQW5CO0FBQ0EsV0FBTyxJQUFQO0FBQ0Q7QUFDRDtBQUNGO0FBQ0E7QUFDQTs7O0FBQ0VFLEVBQUFBLE9BQU8sQ0FBQ0gsSUFBRCxFQUFlQyxJQUFmLEVBQXdD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LFNBQVEsS0FBS0MsYUFBYyxzQkFBN0g7QUFDRDs7QUFFRCxXQUFPaUIsTUFBUDtBQUNEOztBQTdGa0IiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IFRva2VuIH0gZnJvbSBcIi4vdG9rZW4uanNcIjtcblxuLyoqRGF0YSByZXR1cm5lZCBieSBhIHNjYW5uZXIgcGFzc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFNjYW5uZXJEYXRhIHtcbiAgLyoqV2hldGhlciBvciBub3QgdGhlIHBhc3Mgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIHNob3VsZCB0cmlnZ2VyIHRyeWluZyBhbm90aGVyIHR5cGUgb2YgcGFzcyovXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIC8qKlRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyAoaW5jbHVkaW5nIHdoaXRlc3BhY2Uvc3BlY2lhbCkgdGhhdCB3ZXJlIHJlYWQqL1xuICByZWFkQ2hhcnM6IG51bWJlcjtcbiAgLyoqVGhlIG51bWJlciBvZiBsaW5lcyB0b3VjaGVkIGJ5IHRoaXMgbWV0aG9kLiB3aWxsIGluY3JlbWVudCBsaW5lIG51bWJlciBvbiBzb3VyY2UgZXZhbCBkYXRhKi9cbiAgcmVhZExpbmVzOiBudW1iZXI7XG4gIC8qKlRoZSBlcnJvciBzdHJpbmcsIGlmIGFueSwgc2V0IGJ5IGEgcGFzcyAtIHNob3VsZCBvbmx5IGJlIHNldCBpZiBhbiBhY3R1YWwgZXJyb3Igb2NjdXJzLCBhIHBhc3MgbWF5IGZhaWwgd2l0aG91dCBlcnJvciovXG4gIGVycm9yPzogc3RyaW5nO1xuICB0b2tlbj86IFRva2VuO1xufVxuXG4vKipBIHBhc3Mgb2YgYSBzY2FuXG4gKiBFeGFtcGxlczogYSBzdHJpbmcsIG51bWJlciwgbXVsdGktbGluZSBjb21tZW50LCBldGNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTY2FubmVyUGFzcyB7XG4gIChkYXRhOiBzdHJpbmcsIG9mZnNldDogbnVtYmVyKTogU2Nhbm5lckRhdGE7XG59XG5cbmV4cG9ydCBjbGFzcyBTY2FubmVyIHtcbiAgcHJpdmF0ZSBwYXNzZXM6IE1hcDxzdHJpbmcsIFNjYW5uZXJQYXNzPjtcbiAgZGF0YT86IHN0cmluZztcbiAgb2Zmc2V0OiBudW1iZXI7XG4gIHJlYWRMaW5lczogbnVtYmVyO1xuICByZWFkTGluZUNoYXJzOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wYXNzZXMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5vZmZzZXQgPSAwO1xuICAgIHRoaXMucmVhZExpbmVzID0gMDtcbiAgICB0aGlzLnJlYWRMaW5lQ2hhcnMgPSAwO1xuICB9XG4gIC8qKkFkZHMgYSBzY2FuIHBhc3NcbiAgICogV2lsbCB0aHJvdyBhbiBlcnJvciBpZiBwYXNzIHdpdGggc2FtZSBuYW1lIGFscmVhZHkgYWRkZWRcbiAgICogWW91IGNhbiByZXVzZSBwYXNzIGNhbGxiYWNrcyBqdXN0IGZpbmUsIGJ1dCB5b3UnbGwgbmVlZCB0byB1c2UgYSBkaWZmZXJlbnQgbmFtZVxuICAgKiBAcGFyYW0gbmFtZVxuICAgKiBAcGFyYW0gcGFzc1xuICAgKi9cbiAgYWRkUGFzcyhuYW1lOiBzdHJpbmcsIHBhc3M6IFNjYW5uZXJQYXNzKTogdGhpcyB7XG4gICAgaWYgKHRoaXMuaGFzUGFzcyhuYW1lKSkgdGhyb3cgYEFscmVhZHkgYWRkZWQgcGFzcywgZGlkIHlvdSBtZWFuIHRvIG92ZXJyaWRlIFwiJHtuYW1lfVwiIHVzaW5nIHNldFBhc3MgaW5zdGVhZD9gO1xuICAgIHRoaXMuc2V0UGFzcyhuYW1lLCBwYXNzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipTYW1lIGFzIGFkZFBhc3MsIGJ1dCB3b24ndCBiYXJrIGF0IHlvdSBmb3Igb3ZlcndyaXRpbmdcbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIHBhc3MgXG4gICAqL1xuICBzZXRQYXNzKG5hbWU6IHN0cmluZywgcGFzczogU2Nhbm5lclBhc3MpOiB0aGlzIHtcbiAgICB0aGlzLnBhc3Nlcy5zZXQobmFtZSwgcGFzcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgLyoqQ2hlY2tzIGlmIGEgcGFzcyBieSBhIG5hbWUgZXhpc3RzXG4gICAqIFRoaXMgaXMgdXNlZCBpbnRlcm5hbGx5IGZvciBhZGRQYXNzIGFuZCByZW1vdmVQYXNzXG4gICAqIEBwYXJhbSBuYW1lXG4gICAqL1xuICBoYXNQYXNzKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnBhc3Nlcy5oYXMobmFtZSk7XG4gIH1cbiAgcmVtb3ZlUGFzcyhuYW1lOiBzdHJpbmcpOiB0aGlzIHtcbiAgICBpZiAoIXRoaXMuaGFzUGFzcyhuYW1lKSkgdGhyb3cgYENhbm5vdCByZW1vdmUgcGFzcyBcIiR7bmFtZX1cIiBhcyBpdCBpc24ndCBhZGRlZCBjdXJyZW50bHlgO1xuICAgIHRoaXMucGFzc2VzLmRlbGV0ZShuYW1lKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBzZXREYXRhKGRhdGE6IHN0cmluZyk6IHRoaXMge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgaGFzRGF0YSAoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YSAhPSBudWxsICYmIHRoaXMuZGF0YSAhPSB1bmRlZmluZWQ7XG4gIH1cbiAgYXZhaWxhYmxlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5sZW5ndGggLSB0aGlzLm9mZnNldDtcbiAgfVxuICAvKipXaWxsIHJldHVybiB0aGUgbmV4dCB0b2tlbiB1bmxlc3MgdGhlcmUgaXMgYW4gZXJyb3IsIGluIHdoaWNoIGNhc2UgbnVsbCBpcyByZXR1cm5lZFxuICAgKiBcbiAgICovXG4gIG5leHQoKTogVG9rZW4gfCBudWxsIHtcbiAgICBsZXQgcmVzdWx0OiBUb2tlbnxudWxsID0gbnVsbDtcbiAgICBsZXQgcGFzc0RhdGE6IFNjYW5uZXJEYXRhO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0ID09IHVuZGVmaW5lZCkgdGhpcy5vZmZzZXQgPSAwO1xuICAgIGlmICghdGhpcy5oYXNEYXRhKCkpIHRocm93IGBObyBkYXRhIGFzc2lnbmVkLCBjYW5ub3QgZ2V0IG5leHQgdG9rZW5gO1xuICAgIGlmICh0aGlzLm9mZnNldCA+IHRoaXMuZGF0YS5sZW5ndGggLSAxKSB7XG4gICAgICByZXN1bHQgPSBuZXcgVG9rZW4oKTtcbiAgICAgIHJlc3VsdC50eXBlID0gVG9rZW4uVFlQRV9FT0Y7XG4gICAgfVxuXG4gICAgbGV0IGJyZWFrUGFzc0xvb3A6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHRoaXMucGFzc2VzLmZvckVhY2goKHBhc3MsIG5hbWUpID0+IHtcbiAgICAgIGlmIChicmVha1Bhc3NMb29wKSByZXR1cm47XG4gICAgICBwYXNzRGF0YSA9IHBhc3ModGhpcy5kYXRhLCB0aGlzLm9mZnNldCk7XG4gICAgICBpZiAocGFzc0RhdGEuc3VjY2Vzcykge1xuICAgICAgICByZXN1bHQgPSBuZXcgVG9rZW4oKTtcbiAgICAgICAgcmVzdWx0LnR5cGUgPSBuYW1lO1xuICAgICAgICByZXN1bHQuZGF0YSA9IHRoaXMuZGF0YSEuc3Vic3RyaW5nKFxuICAgICAgICAgIHRoaXMub2Zmc2V0LFxuICAgICAgICAgIHRoaXMub2Zmc2V0ICsgcGFzc0RhdGEucmVhZENoYXJzXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMub2Zmc2V0ICs9IHBhc3NEYXRhLnJlYWRDaGFycztcbiAgICAgICAgdGhpcy5yZWFkTGluZXMgKz0gcGFzc0RhdGEucmVhZExpbmVzO1xuICAgICAgICByZXN1bHQubGluZSA9IHRoaXMucmVhZExpbmVzO1xuICAgICAgICBicmVha1Bhc3NMb29wID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIWJyZWFrUGFzc0xvb3ApIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBUb2tlbigpO1xuICAgICAgcmVzdWx0LnR5cGUgPSBcImVycm9yXCI7XG4gICAgICByZXN1bHQuZGF0YSA9IGBcIiR7dGhpcy5kYXRhLnN1YnN0cmluZyh0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyA2KX0uLi5cIiBhdCBsaW5lICR7dGhpcy5yZWFkTGluZXN9IGNoYXIgJHt0aGlzLnJlYWRMaW5lQ2hhcnN9IGNvdWxkIG5vdCBiZSBwYXJzZWRgO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn1cbiJdfQ==